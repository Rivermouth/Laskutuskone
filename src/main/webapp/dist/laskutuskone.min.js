(function(){JsBarcode=function(e,b,a){var c=JsBarcode.defaults,d;for(d in a)c[d]=a[d];a=c;c=document.createElement("canvas");if(!c.getContext)return e;b=new window[a.format](b);if(!b.valid())return this;b=b.encoded();d=c.getContext("2d");c.width=b.length*a.width+2*a.quite;c.height=a.height;d.clearRect(0,0,c.width,c.height);a.backgroundColor&&(d.fillStyle=a.backgroundColor,d.fillRect(0,0,c.width,c.height));d.fillStyle=a.lineColor;for(var m=0;m<b.length;m++){var s=m*a.width+a.quite;"1"==b[m]&&d.fillRect(s,
0,a.width,a.height)}uri=c.toDataURL("image/png");if(e.attr)return e.attr("src",uri);e.setAttribute("src",uri)};JsBarcode.defaults={width:2,height:100,quite:10,format:"CODE128",backgroundColor:"#fff",lineColor:"#000"};window.jQuery&&(jQuery.fn.JsBarcode=function(e,b){JsBarcode(this,e,b)});window.JsBarcode=JsBarcode})();
function CODE128(e,b){function a(){return-1==e.search(k)?!1:!0}function c(a,c,b,d){var f;f=""+l(b);f+=c(a);f+=l(d(a,b));return f+=p}function d(a){for(var c="",b=0;b<a.length;b++){var d;a:{for(d=0;d<g.length;d++)if(g[d][0]==a[b]){d=g[d][1];break a}d=""}c+=d}return c}function m(a){for(var c="",b=0;b<a.length;b+=2)c+=l(parseInt(a.substr(b,2)));return c}function s(a,c){for(var b=0,d=0;d<a.length;d++){var f;a:{for(f=0;f<g.length;f++)if(g[f][0]==a[d]){f=g[f][2];break a}f=0}b+=f*(d+1)}return(b+c)%103}function f(a,
c){for(var b=0,d=1,f=0;f<a.length;f+=2)b+=parseInt(a.substr(f,2))*d,d++;return(b+c)%103}function l(a){for(var c=0;c<g.length;c++)if(g[c][2]==a)return g[c][1];return""}b=b||"B";this.string128=e+"";this.valid=a;this.encoded=function(){return a(e)?q["code128"+b](e):""};var g=[[" ","11011001100",0],["!","11001101100",1],['"',"11001100110",2],["#","10010011000",3],["$","10010001100",4],["%","10001001100",5],["&","10011001000",6],["'","10011000100",7],["(","10001100100",8],[")","11001001000",9],["*","11001000100",
10],["+","11000100100",11],[",","10110011100",12],["-","10011011100",13],[".","10011001110",14],["/","10111001100",15],["0","10011101100",16],["1","10011100110",17],["2","11001110010",18],["3","11001011100",19],["4","11001001110",20],["5","11011100100",21],["6","11001110100",22],["7","11101101110",23],["8","11101001100",24],["9","11100101100",25],[":","11100100110",26],[";","11101100100",27],["<","11100110100",28],["=","11100110010",29],[">","11011011000",30],["?","11011000110",31],["@","11000110110",
32],["A","10100011000",33],["B","10001011000",34],["C","10001000110",35],["D","10110001000",36],["E","10001101000",37],["F","10001100010",38],["G","11010001000",39],["H","11000101000",40],["I","11000100010",41],["J","10110111000",42],["K","10110001110",43],["L","10001101110",44],["M","10111011000",45],["N","10111000110",46],["O","10001110110",47],["P","11101110110",48],["Q","11010001110",49],["R","11000101110",50],["S","11011101000",51],["T","11011100010",52],["U","11011101110",53],["V","11101011000",
54],["W","11101000110",55],["X","11100010110",56],["Y","11101101000",57],["Z","11101100010",58],["[","11100011010",59],["\\","11101111010",60],["]","11001000010",61],["^","11110001010",62],["_","10100110000",63],["`","10100001100",64],["a","10010110000",65],["b","10010000110",66],["c","10000101100",67],["d","10000100110",68],["e","10110010000",69],["f","10110000100",70],["g","10011010000",71],["h","10011000010",72],["i","10000110100",73],["j","10000110010",74],["k","11000010010",75],["l","11001010000",
76],["m","11110111010",77],["n","11000010100",78],["o","10001111010",79],["p","10100111100",80],["q","10010111100",81],["r","10010011110",82],["s","10111100100",83],["t","10011110100",84],["u","10011110010",85],["v","11110100100",86],["w","11110010100",87],["x","11110010010",88],["y","11011011110",89],["z","11011110110",90],["{","11110110110",91],["|","10101111000",92],["}","10100011110",93],["~","10001011110",94],[String.fromCharCode(127),"10111101000",95],[String.fromCharCode(128),"10111100010",
96],[String.fromCharCode(129),"11110101000",97],[String.fromCharCode(130),"11110100010",98],[String.fromCharCode(131),"10111011110",99],[String.fromCharCode(132),"10111101110",100],[String.fromCharCode(133),"11101011110",101],[String.fromCharCode(134),"11110101110",102],[String.fromCharCode(135),"11010000100",103],[String.fromCharCode(136),"11010010000",104],[String.fromCharCode(137),"11010011100",105]],p="1100011101011",k=/^[!-~ ]+$/,q={code128B:function(a){return c(a,d,104,s)},code128C:function(a){a=
a.replace(/ /g,"");return c(a,m,105,f)}}}function CODE128B(e){return new CODE128(e,"B")}function CODE128C(e){return new CODE128(e,"C")}
(function(e,b){var a={backgroundColor:"#fff",lineColor:"#000",strict:!1},c=function(a,c){var b=a.length;return(a.substring(0,b-(""+c).length)+c).substring(0,b)},d=function(c){var d=b.createElement("canvas"),e=d.getContext("2d");d.width=c.offsetWidth;d.height=c.offsetHeight;e.clearRect(0,0,d.width,d.height);e.fillStyle=a.backgroundColor;e.fillRect(0,0,d.width,d.height);e.fillStyle=a.lineColor;e.textAlign="center";e.textBaseline="middle";e.fillText("Virheellinen pankkiviivakoodi",d.width/2,d.height/
2);d=d.toDataURL("image/png");c.setAttribute("src",d)},m=function(c,b,e,g,m,k,q,n){b=function(b,e){if(a.strict)throw d(c),b;console.warn(b+" "+e)};6<(""+e).length?(g=e=0,b("Laskun summa on liian suuri tulostettavaksi viivakoodille.","Tulostetaan summa 00000000.")):2<(""+g).length&&(b("Annetut sentit ovat enemm\u00e4n kuin 99.","Tulostetaan summa 00000000."),g=e=0)};a.luo=function(b,e,l,g,p,k,q,n){b.style.height="10mm";b.style.width="105mm";e=(""+e).replace("FI","").replace(/ /g,"");if(8>arguments.length)throw d(b),
"Unohdit antaa kaikki function vaativat parametrit.";var v=e,t=p;if(20<t.length)throw d(b),"Viitenumero liian pitk\u00e4 (max. 20).";if(4>t.length)throw d(b),"Viitenumero liian lyhyt (min. 4).";if(16!=v.length)throw d(b),"IBAN tilinumero virheellinen.";m(b,e,l,g,p,k,q,n);l=c("000000",l);g=c("00",g);p=c("00000000000000000000",p);n=(""+n).substr(-2);q=c("00",q);k=c("00",k);JsBarcode(b,"4"+e+l+g+"000"+p+n+q+k,{width:4,height:b.offsetHeight,quite:20,format:"CODE128C",backgroundColor:a.backgroundColor,
lineColor:a.lineColor})};e.Pankkiviivakoodi=a})(window,document);
(function(e,b){var a={O:function(){this.link;this.value}};a.O.prototype.value=void 0;a.O.prototype.linkTo=function(a){this.link=a};a.O.prototype.onChange=void 0;a.O.prototype.commitChange=function(a){this.value=a;if(this.link)this.link.onChange(a)};a.O.prototype.notify=function(){this.commitChange(this.value)};a.O.prototype.getValue=function(){return this.value};a.O.prototype.remove=function(){this.link.remove(this)};a.Link=function(){this.value=void 0;this.nextId=0;this.items=[];this.addAll=function(a){for(var b=
0,e=a.length;b<e;++b)this.add(a[b])};this.addAll(arguments)};a.Link.prototype=Object.create(a.O.prototype);a.Link.prototype.add=function(c){if(c instanceof a.O)c._id=this.nextId,c.linkTo(this),this.items.push(c),this.nextId++;else if("string"==typeof c){c=b.querySelectorAll(c);for(var d=0,e=c.length;d<e;++d)this.add(new a.E(c[d]))}else this.add(new a.E(c))};a.Link.prototype.remove=function(a){this.items[a._id]=void 0;this.notify()};a.Link.prototype.setValue=function(a){this.onChange(a);return this};
a.Link.prototype.onChange=function(a){this.value!==a&&(this.value=a,this.notify())};a.Link.prototype.notify=function(){for(var a=0,b=this.items.length;a<b;++a)if(void 0!=this.items[a]&&this.items[a].onChange)this.items[a].onChange(this.value);this.commitChange(this.value)};a.oneway=function(){a.Link.apply(this,arguments)};a.oneway.prototype=Object.create(a.Link.prototype);a.oneway.prototype.onChange=function(a){this.value=a};a.E=function(b){if(void 0!=b&&void 0!=b.tagName){if("input"==b.tagName.toLowerCase())return"checkbox"==
b.type?new a.ECheckbox(b):new a.EInput(b);this.el=b;var d=this;this.el.addEventListener("keyup",function(){d.notify()},!1)}};a.E.prototype=Object.create(a.O.prototype);a.E.prototype.notify=function(){this.commitChange(this.el.textContent)};a.E.prototype.onChange=function(a){this.el.textContent=a};a.EInput=function(a){if(void 0!=a){this.el=a;var b=this;this.el.addEventListener("keyup",function(){b.notify()},!1)}};a.EInput.prototype=Object.create(a.O.prototype);a.EInput.prototype.notify=function(){this.commitChange(this.el.value)};
a.EInput.prototype.onChange=function(a){this.el.value=a};a.ECheckbox=function(a){if(void 0!=a){this.el=a;var b=this;this.el.addEventListener("change",function(){b.notify()},!1)}};a.ECheckbox.prototype=Object.create(a.O.prototype);a.ECheckbox.prototype.notify=function(){this.commitChange(this.el.checked)};a.ECheckbox.prototype.onChange=function(a){this.el.checked=a&&!1!=a&&"false"!=a};e.bn=a.Link;e.bn.O=a.O;e.bn.E=a.E;e.bn.oneway=a.oneway})(window,document);
(function(e,b){var a=function(a,b){if(void 0!=b)a.textContent=b;else return a.textContent},c=function(a){(a=parseFloat(a))||(a=0);return a},d=function(a){var b=a.getDate(),c=a.getMonth()+1;a=a.getFullYear();return b+"."+c+"."+a},m=function(a){var b=new Date;a=a.split(".");b.setDate(a[0]);b.setMonth(a[1]-1);b.setFullYear(a[2]);return b},s=b.querySelector("#biller-name"),f=b.querySelector("#payment-receiver");b.querySelector("#bill-info-table");var l=b.querySelector("#bill-id"),g=b.querySelector("#bill-name"),
p=b.querySelector("#refnum"),k=b.querySelector("#date"),q=b.querySelector("#date-pay"),n=b.querySelector("#dates-to-pay"),v=b.querySelector("#pay-interest"),t=b.querySelector("#account-number"),w=b.querySelector("#account-shortcode"),x=b.querySelector("#client-info"),G=b.querySelector("#additional-info");b.querySelector("#jobs-table");var H=b.querySelector("#novat-total"),I=b.querySelector("#vat-total"),J=b.querySelector("#total"),K=b.querySelector("#notes"),L=b.querySelector("#footer-1"),M=b.querySelector("#footer-2"),
N=b.querySelector("#footer-3"),U=b.querySelector("#barcode"),u=[],r=function(a){this.totalBnO=new bn.O;this.totalBnO.isJobBn=!0;this.el=r.newJobRowEl.cloneNode(!0);this.el.id="";this.el.className="job-row";r.newJobRowEl.parentElement.insertBefore(this.el,r.newJobRowEl);this.addDelEvent();var b=this;this.el.addEventListener("contextmenu",function(){b.totalBnO.remove();this.remove()},!1);this.descEl=this.el.querySelector(".desc");this.countEl=this.el.querySelector(".count");this.countUnitEl=this.el.querySelector(".count-unit");
this.apriceEl=this.el.querySelector(".aprice");this.alvpEl=this.el.querySelector(".alvp");this.alveEl=this.el.querySelector(".alve");this.sumEl=this.el.querySelector(".sum");this.apriceEl.onblur=function(){this.textContent=c(this.textContent).toFixed(2)};this.addBind()};r.newJobRowEl=b.querySelector("#new-job-row");r.prototype.remove=function(){this.el.remove();this.deleted=!0};r.prototype.delEvent=function(a){a.preventDefault();confirm("Haluatko varmasti poistaa kyseisen kohteen?")&&this.remove()};
r.prototype.addDelEvent=function(){var a=this;this.el.addEventListener("contextmenu",function(b){a.delEvent(b)},!1)};r.prototype.count=function(){var a=c(this.countEl.textContent)*c(this.apriceEl.textContent)*(c(this.alvpEl.textContent)/100),b=c(this.countEl.textContent)*c(this.apriceEl.textContent)+a;this.alveEl.textContent=a.toFixed(2);this.sumEl.textContent=b.toFixed(2);this.totalBnO.vat=a;this.totalBnO.total=b;this.totalBnO.link.notify()};r.prototype.addBind=function(){this.totalBnO.vat=0;this.totalBnO.total=
0;var a=this;(new bn.oneway(this.countEl,this.apriceEl,this.alvpEl)).onChange=function(b){a.count()}};r.prototype.toJSON=function(){return{description:a(this.descEl),count:a(this.countEl),count_unit:a(this.countUnitEl),aprice:a(this.apriceEl),alvp:a(this.alvpEl),avle:a(this.alveEl),sum:a(this.sumEl)}};r.prototype.fromJSON=function(b){a(this.descEl,b.description);a(this.countEl,b.count);a(this.countUnitEl,b.count_unit);a(this.apriceEl,b.aprice);a(this.alvpEl,b.alvp);this.count()};var y=!1,z,A,C=new bn(".total"),
O=new bn.O;O.onChange=function(){for(var a=0,b=0,c=0,d=A.items.length;c<d;++c){var e=A.items[c];void 0!=e&&void 0!=e.isJobBn&&(a+=e.vat,b+=e.total)}H.textContent=(b-a).toFixed(2);I.textContent=a.toFixed(2);J.textContent=b.toFixed(2);C.setValue(b.toFixed(2))};var V=new bn(".date-pay"),D=new bn.O;D.onChange=function(a){a=c(a);this.value=d(new Date(+z+864E5*a));q.textContent=this.value;V.setValue(this.value)};var E=new bn.O;E.onChange=function(a){for(var b=0,d=[7,3,1],e=0,f=a.length-1;0<=f;--f)b+=c(a.charAt(f))*
d[e%3],e++;b=10*Math.ceil(b/10)-b;"10"==b&&(b=0);this.value=a+""+b;p.textContent=this.value};var P=new bn.E(n),B=new bn("#account-number"),W=new bn(".account-shortcode"),X=new bn(".client-info"),Q=new bn(D,P),R=new bn(E,l,".bill-id"),S=new bn(Q,R,B,C);S.onChange=function(){var a=(""+C.getValue()).split("."),b=(""+D.getValue()).split(".");if(!y)try{Pankkiviivakoodi.strict=!0,Pankkiviivakoodi.luo(U,B.getValue(),a[0],a[1],""+E.getValue(),b[0],b[1],b[2])}catch(c){console.warn(c),h.notification(c,h.notification.TYPE_WARN)}};
(new bn(k)).onChange=function(){z=m(a(k));Q.notify()};var T=function(){for(var a=0,b=u.length;a<b;++a)u[a].remove();u=[]},F=function(){var a=new r;a.el.children[0].focus();u.push(a);A.add(a.totalBnO);return a},h={initPage:function(){z=new Date;A=new bn(O);T()},update:function(){B.setValue(a(t));W.setValue(a(w));X.setValue(a(x));R.setValue(a(l));for(var c=b.querySelectorAll(".date-today"),e=d(z),f=0,g=c.length;f<g;++f)c[f].textContent=e;P.notify();B.notify();r.newJobRowEl.addEventListener("click",
F,!1)},init:function(){y=!0;h.initPage();h.update();y=!1}};h.addJobRow=F;h.getJobRows=function(){return u};h.getJobRowsJSON=function(){for(var a=[],b=0,c=u.length;b<c;++b)u[b].deleted||a.push(u[b].toJSON());return a};h.setJobRowsFromJSON=function(a){T();for(var b=0,c=a.length;b<c;++b)F().fromJSON(a[b])};h.getJSON=function(){return{biller_name:a(s),payment_receiver:a(f),bill_name:a(g),bill_id:a(l),ref_num:a(p),date:a(k),date_pay:a(q),days_to_pay:a(n),pay_interest:a(v),client:a(x),additional_info:a(G),
no_vat_total:a(H),vat_total:a(I),total:a(J),account_number:a(t),account_shortcode:a(w),job_rows:h.getJobRowsJSON(),footer1:a(L),footer2:a(M),footer3:a(N),notes:a(K)}};h.loadFromJSON=function(b){y=!0;h.initPage();a(s,b.biller_name);a(f,b.payment_receiver);a(g,b.bill_name);a(l,b.bill_id);z=m(b.date);a(n,b.days_to_pay);a(v,b.pay_interest);a(x,b.client);a(G,b.additional_info);a(t,b.account_number);a(w,b.account_shortcode);h.setJobRowsFromJSON(b.job_rows);a(L,b.footer1);a(M,b.footer2);a(N,b.footer3);a(K,
b.notes);h.update();y=!1;S.onChange()};h.notification=function(a,c){c||(c=h.notification.TYPE_OK);var d=b.createElement("div");d.className="notification "+c;d.textContent=a;b.body.appendChild(d);setTimeout(function(){d.className+=" active "},100);setTimeout(function(){d.className=d.className.replace(" active","")},1E3);setTimeout(function(){d.remove()},1300)};h.notification.TYPE_OK="ok";h.notification.TYPE_WARN="warn";e.BillMachine=h})(window,document);
(function(e,b){b.getElementsByTagName("body");b.querySelector("#controls");var a=b.querySelector("#save-name"),c=b.querySelector("#save"),d=b.querySelector("#load"),m=b.querySelector("#new"),s=b.querySelector("#saved-bills"),f=b.querySelector("#tilisiirto"),l=b.querySelector("#show-tilisiirto"),g=!1,p=function(){g=!0;e.removeEventListener(p)},k=function(){g=!1;e.addEventListener("keydown",p,!1);e.addEventListener("contextmenu",p,!1)};k();var q=function(b){return!g||confirm("Tallentamattomat tiedot menetet\u00e4\u00e4n. Haluatko jatkaa?")?
(BillMachine.loadFromJSON(JSON.parse(localStorage[b])),a.value=b,k(),BillMachine.notification("Ladattu",void 0),!0):!1},n=void 0,v=function(a){a.addEventListener("click",function(){q(this.textContent)&&(void 0!=n&&(n.className=n.className.replace(" selected","")),n=this,this.className+=" selected")},!1)},t=function(a){a.addEventListener("contextmenu",function(a){a.preventDefault();a=this.textContent;confirm("Haluatko varmasti poistaa tallennetun laskun?")&&(localStorage.removeItem(a),w(),BillMachine.notification("Poistettu",
void 0))},!1)},w=function(){var a=b.createElement("div");a.className="list-item";var c=b.createDocumentFragment(),d;for(d in localStorage){var e=a.cloneNode(!0);e.textContent=d;c.appendChild(e);v(e);t(e)}s.innerHTML="";s.appendChild(c)},x=function(){var b=a.value;return 0>=b?(alert("Anna tiedostonimi."),!1):b};c.addEventListener("click",function(){var a=x();a&&(k(),localStorage[a]=JSON.stringify(BillMachine.getJSON()),BillMachine.notification("Tallennettu",void 0))},!1);d&&d.addEventListener("click",
function(){var a=x();a&&q(a)},!1);m.addEventListener("click",function(){g&&!confirm("Tallentamattomat tiedot menetet\u00e4\u00e4n. Haluatko jatkaa?")||location.reload()},!1);(new bn(l)).onChange=function(a){f.style.display=a?"block":"none"};BillMachine.init();w()})(window,document);
