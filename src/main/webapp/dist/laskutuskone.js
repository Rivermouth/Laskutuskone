!function(a,b,c){var d=function(){this.totalBnO=new c.O,this.totalBnO.isJobBn=!0,this.el=d.newJobRowEl.cloneNode(!0),this.el.id="",this.el.className="job-row",d.newJobRowEl.parentElement.insertBefore(this.el,d.newJobRowEl),this.addDelEvent(),this.descEl=this.el.querySelector(".desc"),this.countEl=this.el.querySelector(".count"),this.countUnitEl=this.el.querySelector(".count-unit"),this.apriceEl=this.el.querySelector(".aprice"),this.alvpEl=this.el.querySelector(".alvp"),this.alveEl=this.el.querySelector(".alve"),this.sumEl=this.el.querySelector(".sum"),this.apriceEl.onblur=function(){this.textContent=c.des2str(c.elVal(this))},this.addBind()};d.CONFIRM_DELETE="Haluatko varmasti poistaa kyseisen kohteen?",d.newJobRowEl=b.querySelector("#new-job-row"),d.prototype.remove=function(){this.el.remove(),this.deleted=!0},d.prototype.delEvent=function(a){a.preventDefault(),confirm(d.CONFIRM_DELETE)&&(this.totalBnO.remove(),this.remove())},d.prototype.addDelEvent=function(){var a=this;this.el.addEventListener("contextmenu",function(b){a.delEvent(b)},!1)},d.prototype.count=function(){var a=c.elVal(this.countEl)*c.elVal(this.apriceEl)*(c.elVal(this.alvpEl)/100),b=c.elVal(this.countEl)*c.elVal(this.apriceEl)+a;this.alveEl.textContent=c.des2str(a),this.sumEl.textContent=c.des2str(b),this.totalBnO.vat=a,this.totalBnO.total=b,this.totalBnO.link.notify()},d.prototype.addBind=function(){this.totalBnO.vat=0,this.totalBnO.total=0;var a=new c.oneway(this.countEl,this.apriceEl,this.alvpEl),b=this;a.onChange=function(){b.count()}},d.prototype.toJSON=function(){var a={description:c.text(this.descEl),count:c.text(this.countEl),count_unit:c.text(this.countUnitEl),aprice:c.text(this.apriceEl),alvp:c.text(this.alvpEl),avle:c.text(this.alveEl),sum:c.text(this.sumEl)};return a},d.prototype.fromJSON=function(a){c.text(this.descEl,a.description),c.text(this.countEl,a.count),c.text(this.countUnitEl,a.count_unit),c.text(this.apriceEl,a.aprice),c.text(this.alvpEl,a.alvp),this.count()},c.JobRow=d}(window,document,bn),function(a,b,c){var d,e,f=b.querySelector("#biller-name"),g=b.querySelector("#payment-receiver"),h=(b.querySelector("#bill-info-table"),b.querySelector("#bill-id")),i=b.querySelector("#bill-name"),j=b.querySelector("#refnum"),k=b.querySelector("#date"),l=b.querySelector("#date-pay"),m=b.querySelector("#dates-to-pay"),n=b.querySelector("#pay-interest"),o=b.querySelector("#account-number"),p=b.querySelector("#account-shortcode"),q=b.querySelector("#client-info"),r=b.querySelector("#additional-info"),s=(b.querySelector("#jobs-table"),b.querySelector("#novat-total")),t=b.querySelector("#vat-total"),u=b.querySelector("#total"),v=b.querySelector("#notes"),w=b.querySelector("#footer-1"),x=b.querySelector("#footer-2"),y=b.querySelector("#footer-3"),z=b.querySelector("#barcode"),A=[],B=!1,C=new bn(".total"),D=new bn.O;D.onChange=function(){S()};var E=new bn(".date-pay"),F=new bn.O;F.onChange=function(a){this.value=U(a),l.textContent=this.value,E.setValue(this.value)};var G=new bn.O;G.onChange=function(a){this.value=P(a),j.textContent=this.value};var H=new bn.E(m),I=new bn("#account-number"),J=new bn(".account-shortcode"),K=new bn(".client-info"),L=new bn(F,H),M=new bn(G,h,".bill-id"),N=new bn(L,M,I,C);N.onChange=function(){var a=(""+C.getValue()).split("."),b=(""+F.getValue()).split(".");if(!B)try{Pankkiviivakoodi.strict=!0,Pankkiviivakoodi.luo(z,I.getValue(),a[0],a[1],""+G.getValue(),b[0],b[1],b[2])}catch(c){console.warn(c),V.notification(c,V.notification.TYPE_WARN)}};var O=new bn(k);O.onChange=function(){d=bn.stringToDate(bn.text(k)),L.notify()};var P=function(a){for(var b=0,c=[7,3,1],d=3,e=0,f=a.length-1;f>=0;--f)b+=bn.val(a.charAt(f))*c[e%d],e++;var g=10*Math.ceil(b/10)-b;return"10"==g&&(g=0),a+""+g},Q=function(){for(var a=0,b=A.length;b>a;++a)A[a].remove();A=[]},R=function(){var a=new c;return a.el.children[0].focus(),A.push(a),e.add(a.totalBnO),a},S=function(){for(var a=0,b=0,c=0,d=e.items.length;d>c;++c){var f=e.items[c];void 0!=f&&void 0!=f.isJobBn&&(a+=f.vat,b+=f.total)}s.textContent=bn.des2str(b-a),t.textContent=bn.des2str(a),u.textContent=bn.des2str(b),C.setValue(bn.des2str(b))},T=function(){for(var a=b.querySelectorAll(".date-today"),c=bn.dateToString(d),e=0,f=a.length;f>e;++e)a[e].textContent=c},U=function(a){a=bn.val(a);var b=24*a*60*60*1e3,c=new Date(+d+b);return bn.dateToString(c)},V={};V.initPage=function(){d=new Date,e=new bn(D),Q()},V.update=function(){I.setValue(bn.text(o)),J.setValue(bn.text(p)),K.setValue(bn.text(q)),M.setValue(bn.text(h)),T(),H.notify(),I.notify(),c.newJobRowEl.addEventListener("click",R,!1)},V.init=function(){B=!0,V.initPage(),V.update(),B=!1},V.addJobRow=R,V.getJobRows=function(){return A},V.getJobRowsJSON=function(){for(var a=[],b=0,c=A.length;c>b;++b)A[b].deleted||a.push(A[b].toJSON());return a},V.setJobRowsFromJSON=function(a){Q();for(var b=0,c=a.length;c>b;++b)R().fromJSON(a[b])},V.getJSON=function(){return{biller_name:bn.text(f),payment_receiver:bn.text(g),bill_name:bn.text(i),bill_id:bn.text(h),ref_num:bn.text(j),date:bn.text(k),date_pay:bn.text(l),days_to_pay:bn.text(m),pay_interest:bn.text(n),client:bn.text(q),additional_info:bn.text(r),no_vat_total:bn.text(s),vat_total:bn.text(t),total:bn.text(u),account_number:bn.text(o),account_shortcode:bn.text(p),job_rows:V.getJobRowsJSON(),footer1:bn.text(w),footer2:bn.text(x),footer3:bn.text(y),notes:bn.text(v)}},V.loadFromJSON=function(a){B=!0,V.initPage(),bn.text(f,a.biller_name),bn.text(g,a.payment_receiver),bn.text(i,a.bill_name),bn.text(h,a.bill_id),d=bn.stringToDate(a.date),bn.text(m,a.days_to_pay),bn.text(n,a.pay_interest),bn.text(q,a.client),bn.text(r,a.additional_info),bn.text(o,a.account_number),bn.text(p,a.account_shortcode),V.setJobRowsFromJSON(a.job_rows),bn.text(w,a.footer1),bn.text(x,a.footer2),bn.text(y,a.footer3),bn.text(v,a.notes),V.update(),B=!1,N.onChange()},V.notification=function(a,c){c||(c=V.notification.TYPE_OK);var d=b.createElement("div");d.className="notification "+c,d.textContent=a,b.body.appendChild(d),setTimeout(function(){d.className+=" active "},100),setTimeout(function(){d.className=d.className.replace(" active","")},1e3),setTimeout(function(){d.remove()},1300)},V.notification.TYPE_OK="ok",V.notification.TYPE_WARN="warn",V.MIME_TYPE="application/vnd.google.drive.ext-type.rlk",V.folderId=void 0,V.fileId=void 0,bn.BillMachine=V}(window,document,bn.JobRow),function(a,b,c){var d="Tallennettu",e="Tallennettu Driveen",f="Ladattu",g="Poistettu",h="Anna tiedostonimi.",i="Tallentamattomat tiedot menetetään. Haluatko jatkaa?",j="Haluatko varmasti poistaa tallennetun laskun?",k=(b.getElementsByTagName("body")[0],b.querySelector("#controls"),b.querySelector("#save-name")),l=b.querySelector("#save"),m=b.querySelector("#save-to-drive"),n=b.querySelector("#load"),o=b.querySelector("#new"),p=b.querySelector("#open-from-drive"),q=b.querySelector("#saved-bills"),r=b.querySelector("#tilisiirto"),s=b.querySelector("#show-tilisiirto"),t=b.querySelector("#toggle-additional-settings"),u=b.querySelector("#additional-settings"),v=b.querySelector("#show-in-drive"),w=function(a,b){c.notification(a,b)},x=!1,y=function(){x=!0,a.removeEventListener(y)},z=function(){x=!1,a.addEventListener("keydown",y,!1),a.addEventListener("contextmenu",y,!1)};z();var A=function(){return!x||confirm(i)},B=function(a){confirm(j)&&(localStorage.removeItem(a),N(),w(g))},C=function(){A()&&(location.reload(),Q(null))},D=function(a,b){c.loadFromJSON(b),k.value=a,z(),w(f)},E=function(a){if(!a)return console.warn("No file id given. Opening Drive Picker instead."),F();var b=gapi.client.drive.files.get({fileId:a});b.execute(function(a){Drive.downloadFile(a,function(b){Q(a),D(a.title.split(".")[0],JSON.parse(b))})})},F=function(){Drive.openPicker(c.MIME_TYPE,function(a){E(a.id)},!1)},G=function(a){return A()?(D(a,JSON.parse(localStorage[a])),!0):!1},H=function(a){z(),w(a||d)},I=function(a,b){if(!c.folderId)return void Drive.openFolderPicker(function(c){P(c.id),I(a,b)});var d=JSON.stringify(c.getJSON()),f=new Blob([d],{type:c.MIME_TYPE});f.fileName=a+".rlk",Drive.insertFile(f,c.folderId,c.fileId,function(a){Q(a),H(e),b&&b(!0)})},J=function(a){var b=JSON.stringify(c.getJSON());localStorage[a]=b,H()},K=void 0,L=function(a){a.addEventListener("click",function(){G(this.textContent)&&(void 0!=K&&(K.className=K.className.replace(" selected","")),K=this,this.className+=" selected")},!1)},M=function(a){a.addEventListener("contextmenu",function(a){a.preventDefault(),B(this.textContent)},!1)},N=function(){var a=b.createElement("div");a.className="list-item";var c=b.createDocumentFragment();for(var d in localStorage){var e=a.cloneNode(!0);e.textContent=d,c.appendChild(e),L(e),M(e)}q.innerHTML="",q.appendChild(c)},O=function(){var a=k.value;return 0>=a?(alert(h),!1):a},P=function(a){a?(c.folderId=a,v.href="https://drive.google.com/drive/u/0/#folders/"+a,bn.removeClass(v,"disabled")):(c.folderId=void 0,v.href="#",bn.addClass(v,"disabled"))},Q=function(a){a?(P(a.parents[0].id),c.fileId=a.id):(P(null),c.fileId=null)};l.addEventListener("click",function(){var a=O();a&&J(a)},!1),m.addEventListener("click",function(){var a=this,b=O();b&&(a.disabled=!0,I(b,function(){a.disabled=!1}))},!1),n&&n.addEventListener("click",function(){var a=O();a&&G(a)},!1),o.addEventListener("click",function(){C()},!1),p.addEventListener("click",function(){E()});var R=new bn(s);R.onChange=function(a){r.style.display=a?"block":"none"};var S=u.offsetHeight;t.addEventListener("click",function(a){a.preventDefault();var b=bn.toggleClass(u,"active");u.style.height=(b?S:0)+"px"},!1),u.style.height="0px",c.loadSavedList=N,c.openFromDrive=E}(window,document,bn.BillMachine);